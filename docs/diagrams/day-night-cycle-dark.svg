<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1100 695" font-family="Inter, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif">
  <defs>
    <!-- Gradients for phase containers -->
    <linearGradient id="dayGrad" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#B8860B"/>
      <stop offset="100%" style="stop-color:#DAA520"/>
    </linearGradient>
    <linearGradient id="nightGrad" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#4C51BF"/>
      <stop offset="100%" style="stop-color:#6366F1"/>
    </linearGradient>
    <linearGradient id="evalGrad" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#047857"/>
      <stop offset="100%" style="stop-color:#059669"/>
    </linearGradient>

    <!-- Shadows -->
    <filter id="glow" x="-50%" y="-50%" width="200%" height="200%">
      <feGaussianBlur stdDeviation="4" result="blur"/>
      <feMerge>
        <feMergeNode in="blur"/>
        <feMergeNode in="SourceGraphic"/>
      </feMerge>
    </filter>
    <filter id="shadow" x="-20%" y="-20%" width="140%" height="140%">
      <feDropShadow dx="0" dy="4" stdDeviation="6" flood-color="#000" flood-opacity="0.5"/>
    </filter>

    <!-- Arrow markers - white for visibility -->
    <marker id="arrowWhite" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto" markerUnits="strokeWidth">
      <path d="M0,0 L0,6 L9,3 z" fill="#FFFFFF"/>
    </marker>
    <marker id="arrowGold" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto" markerUnits="strokeWidth">
      <path d="M0,0 L0,6 L9,3 z" fill="#FCD34D"/>
    </marker>
    <marker id="arrowIndigo" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto" markerUnits="strokeWidth">
      <path d="M0,0 L0,6 L9,3 z" fill="#A5B4FC"/>
    </marker>
    <marker id="arrowGreen" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto" markerUnits="strokeWidth">
      <path d="M0,0 L0,6 L9,3 z" fill="#6EE7B7"/>
    </marker>
    <marker id="arrowRed" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto" markerUnits="strokeWidth">
      <path d="M0,0 L0,6 L9,3 z" fill="#FCA5A5"/>
    </marker>
  </defs>

  <!-- Dark background -->
  <rect width="1100" height="695" fill="#1A1A2E"/>

  <!-- Subtle grid pattern -->
  <defs>
    <pattern id="grid" patternUnits="userSpaceOnUse" width="40" height="40">
      <path d="M 40 0 L 0 0 0 40" fill="none" stroke="#2A2A4A" stroke-width="0.5"/>
    </pattern>
  </defs>
  <rect width="1100" height="695" fill="url(#grid)" opacity="0.5"/>

  <!-- Title -->
  <text x="550" y="42" text-anchor="middle" font-size="26" font-weight="700" fill="#FFFFFF">Day/Night Continual Learning Cycle</text>
  <text x="550" y="68" text-anchor="middle" font-size="14" fill="#A0AEC0">Self-improving loop: attempt fixes → learn from failures → validate improvements</text>

  <!-- ═══════════════════════════════════════════════════════════════ -->
  <!-- PHASE 1: DAY -->
  <!-- ═══════════════════════════════════════════════════════════════ -->

  <g filter="url(#shadow)">
    <rect x="40" y="100" width="320" height="380" rx="16" fill="url(#dayGrad)"/>
  </g>

  <!-- Day header -->
  <g>
    <circle cx="80" cy="130" r="18" fill="#FCD34D" filter="url(#glow)"/>
    <g stroke="#1A1A2E" stroke-width="2.5" stroke-linecap="round">
      <line x1="80" y1="105" x2="80" y2="95"/>
      <line x1="80" y1="165" x2="80" y2="155"/>
      <line x1="55" y1="130" x2="45" y2="130"/>
      <line x1="115" y1="130" x2="105" y2="130"/>
      <line x1="62" y1="112" x2="55" y2="105"/>
      <line x1="98" y1="148" x2="105" y2="155"/>
      <line x1="62" y1="148" x2="55" y2="155"/>
      <line x1="98" y1="112" x2="105" y2="105"/>
    </g>
    <text x="115" y="126" font-size="20" font-weight="700" fill="#FFFFFF">DAY</text>
    <text x="115" y="146" font-size="12" fill="#FEF3C7">Agent Attempts to Fix Code</text>
  </g>

  <!-- Day flow boxes - dark with light text -->
  <g>
    <!-- Load Task -->
    <rect x="60" y="175" width="130" height="50" rx="8" fill="#292524" stroke="#FCD34D" stroke-width="2"/>
    <text x="125" y="197" text-anchor="middle" font-size="12" font-weight="600" fill="#FFFFFF">Load Task</text>
    <text x="125" y="213" text-anchor="middle" font-size="10" fill="#A0AEC0">from Koans</text>

    <!-- Sandbox -->
    <rect x="210" y="175" width="130" height="50" rx="8" fill="#292524" stroke="#FCD34D" stroke-width="2"/>
    <text x="275" y="197" text-anchor="middle" font-size="12" font-weight="600" fill="#FFFFFF">Sandbox</text>
    <text x="275" y="213" text-anchor="middle" font-size="10" fill="#A0AEC0">cargo check</text>

    <!-- Decision diamond -->
    <polygon points="200,290 250,255 300,290 250,325" fill="#292524" stroke="#FCD34D" stroke-width="2"/>
    <text x="250" y="287" text-anchor="middle" font-size="11" font-weight="600" fill="#FFFFFF">Error?</text>
    <text x="250" y="302" text-anchor="middle" font-size="9" fill="#A0AEC0">check</text>

    <!-- Call LLM -->
    <rect x="60" y="340" width="120" height="50" rx="8" fill="#292524" stroke="#FCD34D" stroke-width="2"/>
    <text x="120" y="362" text-anchor="middle" font-size="12" font-weight="600" fill="#FFFFFF">Call Ollama</text>
    <text x="120" y="378" text-anchor="middle" font-size="10" fill="#A0AEC0">generate fix</text>

    <!-- Apply Fix -->
    <rect x="60" y="265" width="100" height="45" rx="8" fill="#292524" stroke="#FCD34D" stroke-width="2"/>
    <text x="110" y="285" text-anchor="middle" font-size="12" font-weight="600" fill="#FFFFFF">Apply Fix</text>
    <text x="110" y="301" text-anchor="middle" font-size="10" fill="#A0AEC0">update code</text>

    <!-- Success: Create Episode -->
    <rect x="210" y="400" width="130" height="55" rx="8" fill="#065F46" stroke="#6EE7B7" stroke-width="2"/>
    <text x="275" y="422" text-anchor="middle" font-size="12" font-weight="700" fill="#FFFFFF">Episode</text>
    <text x="275" y="438" text-anchor="middle" font-size="10" fill="#A7F3D0">passed: true</text>
    <text x="275" y="452" text-anchor="middle" font-size="9" fill="#6EE7B7">steps, timing, diff</text>
  </g>

  <!-- Day arrows -->
  <path d="M190,200 L210,200" fill="none" stroke="#FCD34D" stroke-width="2" marker-end="url(#arrowGold)"/>
  <path d="M275,225 L275,255" fill="none" stroke="#FCD34D" stroke-width="2" marker-end="url(#arrowGold)"/>
  <path d="M200,290 L160,290" fill="none" stroke="#FCA5A5" stroke-width="2" marker-end="url(#arrowRed)"/>
  <text x="183" y="280" font-size="10" font-weight="600" fill="#FCA5A5">yes</text>
  <path d="M120,340 L120,310" fill="none" stroke="#FCD34D" stroke-width="2" marker-end="url(#arrowGold)"/>
  <path d="M60,287 L60,200 Q60,185 45,185 L45,375 Q45,390 60,390" fill="none" stroke="#FCD34D" stroke-width="2" marker-end="url(#arrowGold)"/>
  <text x="25" y="290" font-size="9" font-weight="500" fill="#FCD34D" transform="rotate(-90, 25, 290)">retry loop</text>
  <path d="M275,325 L275,400" fill="none" stroke="#6EE7B7" stroke-width="2.5" marker-end="url(#arrowGreen)"/>
  <text x="288" y="360" font-size="10" font-weight="600" fill="#6EE7B7">pass</text>

  <!-- ═══════════════════════════════════════════════════════════════ -->
  <!-- PHASE 2: NIGHT -->
  <!-- ═══════════════════════════════════════════════════════════════ -->

  <g filter="url(#shadow)">
    <rect x="400" y="100" width="320" height="380" rx="16" fill="url(#nightGrad)"/>
  </g>

  <!-- Night header -->
  <g>
    <circle cx="440" cy="130" r="16" fill="#A5B4FC" filter="url(#glow)"/>
    <circle cx="450" cy="122" r="12" fill="url(#nightGrad)"/>
    <text x="475" y="126" font-size="20" font-weight="700" fill="#FFFFFF">NIGHT</text>
    <text x="475" y="146" font-size="12" fill="#C7D2FE">LoRA Fine-tuning on Failures</text>
  </g>

  <!-- Night flow boxes -->
  <g>
    <rect x="420" y="175" width="140" height="50" rx="8" fill="#1E1B4B" stroke="#A5B4FC" stroke-width="2"/>
    <text x="490" y="197" text-anchor="middle" font-size="12" font-weight="600" fill="#FFFFFF">Load Episodes</text>
    <text x="490" y="213" text-anchor="middle" font-size="10" fill="#A0AEC0">failed_then_fixed</text>

    <rect x="420" y="245" width="140" height="50" rx="8" fill="#1E1B4B" stroke="#A5B4FC" stroke-width="2"/>
    <text x="490" y="267" text-anchor="middle" font-size="12" font-weight="600" fill="#FFFFFF">Curate Dataset</text>
    <text x="490" y="283" text-anchor="middle" font-size="10" fill="#A0AEC0">balance classes</text>

    <!-- Data mix annotation -->
    <rect x="575" y="240" width="130" height="60" rx="6" fill="#312E81" stroke="#818CF8" stroke-width="1.5"/>
    <text x="640" y="260" text-anchor="middle" font-size="10" font-weight="600" fill="#C7D2FE">Data Mix</text>
    <text x="640" y="277" text-anchor="middle" font-size="9" fill="#A5B4FC">44% replay</text>
    <text x="640" y="292" text-anchor="middle" font-size="9" fill="#A5B4FC">42% success | 14% hard</text>

    <rect x="420" y="315" width="140" height="55" rx="8" fill="#1E1B4B" stroke="#A5B4FC" stroke-width="2"/>
    <text x="490" y="337" text-anchor="middle" font-size="12" font-weight="700" fill="#FFFFFF">LoRA Fine-tune</text>
    <text x="490" y="354" text-anchor="middle" font-size="10" fill="#C7D2FE">r=8, α=16</text>
    <text x="490" y="368" text-anchor="middle" font-size="9" fill="#A5B4FC">300-500 steps</text>

    <rect x="420" y="390" width="140" height="50" rx="8" fill="#1E1B4B" stroke="#A5B4FC" stroke-width="2"/>
    <text x="490" y="412" text-anchor="middle" font-size="12" font-weight="600" fill="#FFFFFF">Save Adapter</text>
    <text x="490" y="428" text-anchor="middle" font-size="10" fill="#A0AEC0">+ metadata</text>

    <!-- Share annotation -->
    <rect x="575" y="385" width="130" height="60" rx="6" fill="#312E81" stroke="#818CF8" stroke-width="1.5"/>
    <text x="640" y="405" text-anchor="middle" font-size="10" font-weight="600" fill="#C7D2FE">Share (Phase 2)</text>
    <text x="640" y="422" text-anchor="middle" font-size="9" fill="#A5B4FC">Extract shared basis</text>
    <text x="640" y="437" text-anchor="middle" font-size="9" fill="#A5B4FC">Coeff-only training</text>
  </g>

  <!-- Night arrows -->
  <path d="M490,225 L490,245" fill="none" stroke="#A5B4FC" stroke-width="2" marker-end="url(#arrowIndigo)"/>
  <path d="M490,295 L490,315" fill="none" stroke="#A5B4FC" stroke-width="2" marker-end="url(#arrowIndigo)"/>
  <path d="M490,370 L490,390" fill="none" stroke="#A5B4FC" stroke-width="2" marker-end="url(#arrowIndigo)"/>
  <path d="M560,270 L575,270" fill="none" stroke="#818CF8" stroke-width="1.5"/>
  <path d="M560,415 L575,415" fill="none" stroke="#818CF8" stroke-width="1.5"/>

  <!-- ═══════════════════════════════════════════════════════════════ -->
  <!-- PHASE 3: EVAL -->
  <!-- ═══════════════════════════════════════════════════════════════ -->

  <g filter="url(#shadow)">
    <rect x="760" y="100" width="300" height="380" rx="16" fill="url(#evalGrad)"/>
  </g>

  <!-- Eval header -->
  <g>
    <circle cx="800" cy="130" r="16" fill="#6EE7B7" filter="url(#glow)"/>
    <polyline points="791,130 797,137 811,121" stroke="#065F46" stroke-width="3.5" fill="none" stroke-linecap="round" stroke-linejoin="round"/>
    <text x="830" y="126" font-size="20" font-weight="700" fill="#FFFFFF">EVAL</text>
    <text x="830" y="146" font-size="12" fill="#A7F3D0">Gated Promotion</text>
  </g>

  <!-- Eval flow boxes -->
  <g>
    <rect x="780" y="175" width="140" height="50" rx="8" fill="#064E3B" stroke="#6EE7B7" stroke-width="2"/>
    <text x="850" y="197" text-anchor="middle" font-size="12" font-weight="600" fill="#FFFFFF">Run Frozen Set</text>
    <text x="850" y="213" text-anchor="middle" font-size="10" fill="#A7F3D0">30 held-out tasks</text>

    <rect x="780" y="245" width="140" height="50" rx="8" fill="#064E3B" stroke="#6EE7B7" stroke-width="2"/>
    <text x="850" y="267" text-anchor="middle" font-size="12" font-weight="600" fill="#FFFFFF">Compute Metrics</text>
    <text x="850" y="283" text-anchor="middle" font-size="10" fill="#A7F3D0">compare to baseline</text>

    <!-- Metrics annotation -->
    <rect x="935" y="175" width="115" height="85" rx="6" fill="#065F46" stroke="#34D399" stroke-width="1.5"/>
    <text x="992" y="195" text-anchor="middle" font-size="10" font-weight="600" fill="#ECFDF5">Metrics</text>
    <text x="992" y="213" text-anchor="middle" font-size="9" fill="#6EE7B7">pass_rate</text>
    <text x="992" y="228" text-anchor="middle" font-size="9" fill="#6EE7B7">frozen_pass_rate</text>
    <text x="992" y="243" text-anchor="middle" font-size="9" fill="#6EE7B7">repeat_error_rate</text>
    <text x="992" y="258" text-anchor="middle" font-size="9" fill="#6EE7B7">median_steps</text>

    <!-- Gate diamond -->
    <polygon points="850,340 915,305 980,340 915,375" fill="#064E3B" stroke="#6EE7B7" stroke-width="2"/>
    <text x="915" y="337" text-anchor="middle" font-size="11" font-weight="600" fill="#FFFFFF">Gates</text>
    <text x="915" y="352" text-anchor="middle" font-size="10" fill="#A7F3D0">Pass?</text>

    <!-- Promote -->
    <rect x="780" y="405" width="105" height="55" rx="8" fill="#065F46" stroke="#6EE7B7" stroke-width="3"/>
    <text x="832" y="428" text-anchor="middle" font-size="12" font-weight="700" fill="#FFFFFF">Promote</text>
    <text x="832" y="446" text-anchor="middle" font-size="10" fill="#6EE7B7">→ Ollama</text>

    <!-- Keep Previous -->
    <rect x="920" y="405" width="105" height="55" rx="8" fill="#7F1D1D" stroke="#FCA5A5" stroke-width="2"/>
    <text x="972" y="428" text-anchor="middle" font-size="12" font-weight="600" fill="#FFFFFF">Keep Old</text>
    <text x="972" y="446" text-anchor="middle" font-size="10" fill="#FCA5A5">log reason</text>
  </g>

  <!-- Eval arrows -->
  <path d="M850,225 L850,245" fill="none" stroke="#6EE7B7" stroke-width="2" marker-end="url(#arrowGreen)"/>
  <path d="M850,295 L850,305" fill="none" stroke="#6EE7B7" stroke-width="2" marker-end="url(#arrowGreen)"/>
  <path d="M920,220 L935,220" fill="none" stroke="#34D399" stroke-width="1.5"/>
  <path d="M865,375 L835,405" fill="none" stroke="#6EE7B7" stroke-width="2.5" marker-end="url(#arrowGreen)"/>
  <text x="838" y="388" font-size="10" font-weight="600" fill="#6EE7B7">yes</text>
  <path d="M965,375 L970,405" fill="none" stroke="#FCA5A5" stroke-width="2" marker-end="url(#arrowRed)"/>
  <text x="980" y="388" font-size="10" font-weight="600" fill="#FCA5A5">no</text>

  <!-- ═══════════════════════════════════════════════════════════════ -->
  <!-- BOTTOM INFO BOXES -->
  <!-- ═══════════════════════════════════════════════════════════════ -->

  <!-- Cycle Progress -->
  <g transform="translate(40, 520)">
    <rect width="160" height="70" rx="10" fill="#292524" stroke="#525252" stroke-width="2"/>
    <text x="80" y="24" text-anchor="middle" font-size="11" font-weight="700" fill="#FFFFFF">Cycle Progress</text>
    <circle cx="35" cy="50" r="10" fill="#059669"/>
    <text x="35" y="54" text-anchor="middle" font-size="9" font-weight="700" fill="#FFFFFF">0</text>
    <circle cx="62" cy="50" r="10" fill="#059669"/>
    <text x="62" y="54" text-anchor="middle" font-size="9" font-weight="700" fill="#FFFFFF">1</text>
    <circle cx="89" cy="50" r="10" fill="#6366F1"/>
    <text x="89" y="54" text-anchor="middle" font-size="9" font-weight="700" fill="#FFFFFF">2</text>
    <circle cx="116" cy="50" r="10" fill="#404040" stroke="#525252"/>
    <text x="116" y="54" text-anchor="middle" font-size="9" fill="#A0AEC0">3</text>
    <circle cx="143" cy="50" r="10" fill="#404040" stroke="#525252"/>
    <text x="143" y="54" text-anchor="middle" font-size="9" fill="#A0AEC0">n</text>
  </g>

  <!-- Gating Criteria -->
  <g transform="translate(220, 520)">
    <rect width="210" height="100" rx="10" fill="#292524" stroke="#525252" stroke-width="2"/>
    <text x="105" y="24" text-anchor="middle" font-size="11" font-weight="700" fill="#FFFFFF">Gating Criteria</text>
    <g font-size="10" fill="#E5E7EB">
      <text x="15" y="46">pass_rate ≥ 0.85</text>
      <text x="15" y="63">frozen_pass_rate: no regression</text>
      <text x="15" y="80">repeat_error_rate: ↓ decreasing</text>
      <text x="15" y="97">median_steps: ↓ improving</text>
    </g>
  </g>

  <!-- Timing -->
  <g transform="translate(450, 520)">
    <rect width="140" height="100" rx="10" fill="#292524" stroke="#525252" stroke-width="2"/>
    <text x="70" y="24" text-anchor="middle" font-size="11" font-weight="700" fill="#FFFFFF">Typical Cycle</text>
    <g font-size="10" fill="#E5E7EB">
      <circle cx="22" cy="46" r="6" fill="#DAA520"/>
      <text x="36" y="50">Day: 30 tasks</text>
      <circle cx="22" cy="68" r="6" fill="#6366F1"/>
      <text x="36" y="72">Night: 300-500 steps</text>
      <circle cx="22" cy="90" r="6" fill="#059669"/>
      <text x="36" y="94">Eval: 30 frozen</text>
    </g>
  </g>

  <!-- Legend -->
  <g transform="translate(610, 520)">
    <rect width="190" height="100" rx="10" fill="#292524" stroke="#525252" stroke-width="2"/>
    <text x="15" y="24" font-size="11" font-weight="700" fill="#FFFFFF">Legend</text>
    <rect x="15" y="38" width="20" height="14" rx="3" fill="url(#dayGrad)"/>
    <text x="42" y="50" font-size="10" fill="#E5E7EB">Day: Inference</text>
    <rect x="100" y="38" width="20" height="14" rx="3" fill="url(#nightGrad)"/>
    <text x="127" y="50" font-size="10" fill="#E5E7EB">Night: Training</text>
    <rect x="15" y="60" width="20" height="14" rx="3" fill="url(#evalGrad)"/>
    <text x="42" y="72" font-size="10" fill="#E5E7EB">Eval: Validation</text>
    <line x1="100" y1="67" x2="130" y2="67" stroke="#FFFFFF" stroke-width="3"/>
    <text x="137" y="72" font-size="10" fill="#E5E7EB">Flow</text>
    <line x1="15" y1="89" x2="45" y2="89" stroke="#FFFFFF" stroke-width="3" stroke-dasharray="8,4"/>
    <text x="52" y="93" font-size="10" fill="#E5E7EB">Cycle back</text>
  </g>

  <!-- Ollama box -->
  <g transform="translate(820, 520)">
    <rect width="130" height="100" rx="10" fill="#292524" stroke="#525252" stroke-width="2"/>
    <text x="65" y="24" text-anchor="middle" font-size="11" font-weight="700" fill="#FFFFFF">Ollama LLM</text>
    <circle cx="65" cy="58" r="20" fill="#404040" stroke="#A0AEC0" stroke-width="2"/>
    <path d="M52,52 Q60,45 65,52 Q70,45 78,52" fill="none" stroke="#A0AEC0" stroke-width="2"/>
    <path d="M52,64 Q60,71 65,64 Q70,71 78,64" fill="none" stroke="#A0AEC0" stroke-width="2"/>
    <text x="65" y="95" text-anchor="middle" font-size="9" fill="#A0AEC0">qwen2.5-coder:1.5b</text>
  </g>

  <!-- ═══════════════════════════════════════════════════════════════ -->
  <!-- PHASE TRANSITIONS (rendered last to appear on top) -->
  <!-- ═══════════════════════════════════════════════════════════════ -->

  <!-- Day → SQLite box (between phases) -->
  <rect x="345" y="488" width="90" height="40" rx="8" fill="#292524" stroke="#FFFFFF" stroke-width="2"/>
  <ellipse cx="390" cy="500" rx="12" ry="4" fill="none" stroke="#A0AEC0" stroke-width="1.5"/>
  <path d="M378,500 v10 a12,4 0 0,0 24,0 v-10" fill="none" stroke="#A0AEC0" stroke-width="1.5"/>
  <text x="390" y="524" text-anchor="middle" font-size="9" font-weight="600" fill="#FFFFFF">SQLite</text>

  <!-- Day → SQLite arrow -->
  <path d="M275,455 L275,495 L345,508" fill="none" stroke="#FFFFFF" stroke-width="3.5" marker-end="url(#arrowWhite)"/>
  <text x="290" y="485" font-size="11" font-weight="600" fill="#FFFFFF">episodes</text>

  <!-- SQLite → Night arrow -->
  <path d="M435,508 L490,508 L490,480" fill="none" stroke="#FFFFFF" stroke-width="3.5" marker-end="url(#arrowWhite)"/>

  <!-- Night → Eval -->
  <path d="M720,340 L760,340" fill="none" stroke="#FFFFFF" stroke-width="3.5" marker-end="url(#arrowWhite)"/>
  <text x="740" y="328" font-size="11" font-weight="600" fill="#FFFFFF">adapter</text>

  <!-- Eval → Day (cycle back) - goes below bottom boxes -->
  <path d="M832,480 L832,660 L200,660 L200,480" fill="none" stroke="#FFFFFF" stroke-width="3.5" stroke-dasharray="12,6" marker-end="url(#arrowWhite)"/>
  <text x="520" y="678" text-anchor="middle" font-size="12" font-weight="600" fill="#FFFFFF">Next cycle with improved model</text>

</svg>
